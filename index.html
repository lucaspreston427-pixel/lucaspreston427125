<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Roblox Shirt Generator (safe textures)</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;max-width:1000px;margin:24px auto;padding:12px;}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;}
  h1{font-size:1.2rem;margin:0}
  .controls{display:grid;grid-template-columns:1fr 320px;gap:12px;margin-top:12px;}
  .panel{background:#f6f6f8;padding:12px;border-radius:8px}
  button, input[type="file"]{font-size:14px;padding:8px;border-radius:6px;border:1px solid #ddd}
  canvas{width:100%;height:auto;border:1px solid #ccc;background:checkerboard}
  .small{font-size:13px;color:#444}
  .texture-list{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .thumb{width:64px;height:64px;object-fit:cover;border:1px solid #ccc;border-radius:6px}
  label.row{display:flex;gap:8px;align-items:center}
  footer{margin-top:16px;font-size:12px;color:#666}
</style>
</head>
<body>
<header>
  <h1>Roblox Shirt Generator — safe textures only</h1>
  <div class="small">Generates random shirt images from uploaded or permissive-source textures</div>
</header>

<div class="controls">
  <div class="panel">
    <h3>1) Add textures (upload or use random free images)</h3>
    <div><input id="file" type="file" accept="image/*" multiple /></div>
    <div style="margin-top:8px;">
      <button id="add-sample">Add random free texture(s)</button>
      <button id="clear-textures">Clear textures</button>
    </div>
    <div class="texture-list" id="textureList"></div>

    <h3 style="margin-top:12px;">2) Generation options</h3>
    <label class="row"><input id="useCrop" type="checkbox" checked /> Randomly crop textures (more variety)</label>
    <label class="row"><input id="rotate" type="checkbox" /> Random rotate tiles</label>
    <label class="row">Tiles per area:
      <select id="tilesCount"><option>1</option><option>2</option><option>3</option><option>4</option></select>
    </label>

    <div style="margin-top:8px;">
      <button id="generate">Generate Random Shirt</button>
      <button id="export">Export PNG</button>
    </div>

    <p class="small">Copyright note: Do NOT upload or paste images you don't own or that explicitly forbid reuse. Use public-domain or your own images.</p>
  </div>

  <div class="panel">
    <h3>Preview</h3>
    <!-- Canvas sized to Roblox-style template: 1024 x 1024 for simplicity -->
    <canvas id="canvas" width="1024" height="1024"></canvas>
    <p class="small">This preview shows the final composite. Transparent areas are left blank (non-shirt).</p>
  </div>
</div>

<footer>
  Tip: Upload several textures, click "Generate Random Shirt" multiple times to get different composites. You can also add your own texture URLs in the code to preload.
</footer>

<script>
/*
  Simple Roblox-style template mask drawn programmatically.
  The script:
   - Maintains a texture pool (uploaded files + "sample" random images from Unsplash Source)
   - For each template area (front/back/left/right/lArm/rArm), it draws random crops/tiles of chosen textures using a mask
   - Exports the final canvas as PNG
  NOTE: This is a simplified visual template for demonstration. Replace the mask drawing with a real Roblox template image if you have one.
*/

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d', {alpha: true});
const fileInput = document.getElementById('file');
const textureListDiv = document.getElementById('textureList');
const addSampleBtn = document.getElementById('add-sample');
const clearBtn = document.getElementById('clear-textures');
const generateBtn = document.getElementById('generate');
const exportBtn = document.getElementById('export');
const useCropCheck = document.getElementById('useCrop');
const rotateCheck = document.getElementById('rotate');
const tilesSelect = document.getElementById('tilesCount');

let textures = []; // {img:Image, url:string}

function addTextureFromBlob(blob, urlHint){
  const img = new Image();
  img.crossOrigin = "anonymous";
  const url = URL.createObjectURL(blob);
  img.onload = () => {
    textures.push({img, url: urlHint || url});
    renderTextureThumbs();
    URL.revokeObjectURL(url);
  };
  img.onerror = () => {
    console.warn('image load error', url);
  };
  img.src = url;
}

fileInput.addEventListener('change', e=>{
  const files = Array.from(e.target.files);
  files.forEach(f => addTextureFromBlob(f, f.name));
  fileInput.value = '';
});

function renderTextureThumbs(){
  textureListDiv.innerHTML = '';
  textures.forEach((t, i)=>{
    const img = document.createElement('img');
    img.src = t.img.src;
    img.className = 'thumb';
    img.title = t.url;
    img.addEventListener('click', ()=>{ // remove on click
      if(confirm('Remove this texture?')){textures.splice(i,1); renderTextureThumbs();}
    });
    textureListDiv.appendChild(img);
  });
}

addSampleBtn.addEventListener('click', async ()=>{
  // Add a few random textures from Unsplash Source (permissive demo). These are free photos but check license for production use.
  const count = 4;
  for(let i=0;i<count;i++){
    const img = new Image();
    img.crossOrigin = "anonymous";
    // Unsplash Source gives a random image for the query "texture", size 512x512
    const url = `https://source.unsplash.com/random/512x512?texture,pattern,cloth`;
    await new Promise((res, rej)=>{
      img.onload = () => { textures.push({img, url}); renderTextureThumbs(); res(); };
      img.onerror = ()=> { console.warn('sample load failed'); res(); };
      img.src = url + '&' + Math.random(); // cache-bust
    });
  }
});

clearBtn.addEventListener('click', ()=>{ if(confirm('Clear all textures?')){textures = []; renderTextureThumbs();}});

function clearCanvas(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
}

// Draw a simplified Roblox shirt mask using path shapes.
// Areas will be: front (center), back (top), left/right arms (sides) — this is illustrative.
function drawTemplateMaskPath(ctx){
  // We'll return a Path2D representing the mask area (shirt parts)
  const p = new Path2D();
  // Front rectangle (center)
  p.rect(262, 300, 500, 520); // main front
  // Back (top)
  p.rect(262, 40, 500, 240);
  // Left arm
  p.rect(50, 360, 180, 240);
  // Right arm
  p.rect(794, 360, 180, 240);
  // small neck hole: cut out
  const neck = new Path2D();
  neck.rect(448, 220, 128, 60);
  // Path2D doesn't support subtraction; we'll just mark neck as white later
  return {mask:p, neckRect: {x:448,y:220,w:128,h:60}};
}

const template = drawTemplateMaskPath(ctx);

function drawCheckerboard(){
  // optional: draw background checkerboard to show transparency
  const s = 32;
  for(let y=0;y<canvas.height;y+=s){
    for(let x=0;x<canvas.width;x+=s){
      ctx.fillStyle = ((x/s + y/s) % 2 === 0) ? '#eee' : '#ddd';
      ctx.fillRect(x,y,s,s);
    }
  }
}

function compositeTexturesRandomly(){
  if(textures.length === 0){ alert('Add at least one texture (upload or add random free textures).'); return; }
  clearCanvas();
  drawCheckerboard();

  // We'll draw onto an offscreen canvas equal to main canvas then mask.
  const off = document.createElement('canvas');
  off.width = canvas.width; off.height = canvas.height;
  const octx = off.getContext('2d');

  // Areas list with rectangles to fill (these match mask rectangles)
  const areas = [
    {name:'back', x:262, y:40, w:500, h:240},
    {name:'front', x:262, y:300, w:500, h:520},
    {name:'leftArm', x:50, y:360, w:180, h:240},
    {name:'rightArm', x:794, y:360, w:180, h:240},
  ];

  const tilesPerArea = parseInt(tilesSelect.value || '1',10);

  areas.forEach(area=>{
    // For each tile slot, pick a random texture and draw a cropped/ tiled region
    for(let ty=0; ty<tilesPerArea; ty++){
      for(let tx=0; tx<tilesPerArea; tx++){
        const tex = textures[Math.floor(Math.random()*textures.length)];
        const img = tex.img;

        // compute destination tile rect
        const dw = Math.floor(area.w/tilesPerArea);
        const dh = Math.floor(area.h/tilesPerArea);
        const dx = area.x + tx*dw;
        const dy = area.y + ty*dh;

        // Source crop
        let sx=0, sy=0, sw=img.width, sh=img.height;
        if(useCropCheck.checked){
          // pick random crop smaller than image
          const cropW = Math.floor(img.width * (0.3 + Math.random()*0.7));
          const cropH = Math.floor(img.height * (0.3 + Math.random()*0.7));
          sx = Math.floor(Math.random()*(img.width - cropW));
          sy = Math.floor(Math.random()*(img.height - cropH));
          sw = cropW; sh = cropH;
        }

        // rotation
        if(rotateCheck.checked && Math.random() > 0.5){
          // draw into small temp canvas with rotation
          const tmp = document.createElement('canvas');
          tmp.width = sw; tmp.height = sh;
          const tctx = tmp.getContext('2d');
          // draw cropped image onto tmp
          tctx.drawImage(img, sx, sy, sw, sh, 0, 0, sw, sh);
          // now draw rotated onto octx
          octx.save();
          // translate to center of destination
          octx.translate(dx + dw/2, dy + dh/2);
          octx.rotate((Math.random()*360|0) * Math.PI/180);
          // scale to fit destination
          octx.drawImage(tmp, -dw/2, -dh/2, dw, dh);
          octx.restore();
        } else {
          // normal draw - scale crop to tile
          octx.drawImage(img, sx, sy, sw, sh, dx, dy, dw, dh);
        }
      }
    }
  });

  // Now apply mask: create a composite where only the mask area is visible
  // We'll draw the offscreen into main but clip to mask
  ctx.save();
  ctx.globalCompositeOperation = 'source-over';

  // First draw off onto canvas
  // But we want off only inside the mask: use clipping
  ctx.beginPath();
  ctx.fillStyle = 'black';
  ctx.fill(template.mask); // create path
  ctx.clip(); // clip to shirt areas
  ctx.drawImage(off, 0, 0);
  ctx.restore();

  // Optionally erase neck rect to simulate cutout
  ctx.clearRect(template.neckRect.x, template.neckRect.y, template.neckRect.w, template.neckRect.h);

  // Draw faint outlines for visual reference
  ctx.save();
  ctx.strokeStyle = 'rgba(0,0,0,0.15)';
  ctx.lineWidth = 2;
  ctx.stroke(template.mask);
  ctx.restore();
}

generateBtn.addEventListener('click', ()=>compositeTexturesRandomly());

exportBtn.addEventListener('click', ()=>{
  // Download the canvas as PNG
  const data = canvas.toDataURL('image/png');
  const a = document.createElement('a');
  a.href = data;
  a.download = 'roblox_shirt.png';
  a.click();
});
</script>
</body>
</html>
